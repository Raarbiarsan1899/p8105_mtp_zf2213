p8105 midterm project
================
Zanis Fang, UID: ZF2213
10/16/2018

**three or four figures would be enough**

### loading data

Columns are values rather than variables, load data and gather the
columns

The dataset records every minute in a day. There are in total 329 days.

(Write more about dataset, make variable name more reasonable)

### Data tidying

``` r
# loading data and make to tall table
activity <- read_csv("./data/p8105_mtp_data.csv") %>% 
    # gather into long table
    gather(key = "minute_in_day", value = "counts", activity.1:activity.1440) %>% 
    # get the "minute" of a day, 
    mutate(minute_in_day = str_replace(minute_in_day, "activity.", "")) %>% 
    # change to integer
    mutate(minute_in_day = as.integer(minute_in_day)) %>% 
    # make day in week variable factor and relevel the day variable
    rename(day_in_week = day) %>%
    mutate(day_in_week = forcats::fct_relevel(day_in_week, c("Sunday", "Monday",
                                                                                                                     "Tuesday", "Wednesday",
                                                                                                                     "Thursday", "Friday",
                                                                                                                     "Saturday"))) %>% 
    # assuming the start of the first week is Sunday
    mutate(day = (week - 1) * 7 + as.integer(day_in_week)) %>% 
    # arrange the variable
    select(day, week, day_in_week, minute_in_day, counts)
```

    ## Parsed with column specification:
    ## cols(
    ##   .default = col_double(),
    ##   week = col_integer(),
    ##   day = col_character()
    ## )

    ## See spec(...) for full column specifications.

### Across the day

``` r
activity_day_total <- activity %>% 
# aggregate across minutes to create total activity
    group_by(day, day_in_week, week) %>% 
  summarize(day_total = sum(counts))

# the distribution of total activity in a day looks as this. However, there are some outliers that should not include in 

library(patchwork)

activity_day_total %>% 
  group_by(outliers = day_total > 100000) %>%
    ggplot(aes(x = day_total)) +
      geom_density() +
      coord_flip()
```

<img src="p8105_mtp_zf2213_files/figure-gfm/unnamed-chunk-1-1.png" width="100%" />

``` r
# day total counts over time
activity_day_total %>%
    group_by(outliers = day_total > 100000) %>%
    ggplot(aes(x = day, y = day_total, shape = outliers)) +
      geom_point(size = 2) +
      geom_smooth(method = "lm")
```

<img src="p8105_mtp_zf2213_files/figure-gfm/unnamed-chunk-1-2.png" width="100%" />

``` r
summary(lm(day ~ day_total, data = activity_day_total))
```

    ## 
    ## Call:
    ## lm(formula = day ~ day_total, data = activity_day_total)
    ## 
    ## Residuals:
    ##      Min       1Q   Median       3Q      Max 
    ## -182.423  -72.111   -0.134   75.795  192.610 
    ## 
    ## Coefficients:
    ##              Estimate Std. Error t value Pr(>|t|)    
    ## (Intercept) 8.744e+01  1.220e+01   7.165 5.18e-12 ***
    ## day_total   2.241e-04  3.229e-05   6.941 2.10e-11 ***
    ## ---
    ## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
    ## 
    ## Residual standard error: 88.94 on 327 degrees of freedom
    ## Multiple R-squared:  0.1284, Adjusted R-squared:  0.1258 
    ## F-statistic: 48.18 on 1 and 327 DF,  p-value: 2.097e-11

``` r
# across week, show the distribution of activities for each day in a week
activity_day_total %>%
    filter(day_total > 100000) %>% 
    ggplot(aes(y = day_total, x = day, group = day_in_week)) +
      geom_boxplot() +
      geom_point(aes(color = day_in_week)) +
      geom_smooth(alpha = 0.3) +
      facet_grid(. ~ day_in_week)
```

    ## `geom_smooth()` using method = 'loess' and formula 'y ~ x'

<img src="p8105_mtp_zf2213_files/figure-gfm/unnamed-chunk-1-3.png" width="100%" />
(add some statistical parts)

### Activities over a day

``` r
# display 24-hour profile for each day using 2d density plot
activity %>%
    ggplot(aes(y = minute_in_day, x = day, color = log10(counts))) +
      geom_point(size = 0.1, alpha = 0.5) +
      scale_x_continuous(breaks = c(1, 55, 92, 107, 185, 243, 300, 329)) +
      viridis::scale_color_viridis(
        name = "Location",
        discrete = FALSE
      )
```

<img src="p8105_mtp_zf2213_files/figure-gfm/unnamed-chunk-2-1.png" width="100%" />

``` r
# refer to supplementary material for special days
```

### Daily distribution

``` r
activity %>%
    # grouping to get number of a type of activity
    group_by(minute_in_day, day_in_week) %>%
    summarize(total_activity = sum(counts)) %>%
    ggplot(aes(x = minute_in_day, y = total_activity, color = day_in_week)) +
      geom_point(size = 0.6) +
      geom_smooth()
```

    ## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'

<img src="p8105_mtp_zf2213_files/figure-gfm/unnamed-chunk-3-1.png" width="100%" />

``` r
activity %>%
    # grouping to get number of a type of activity
    group_by(minute_in_day, day_in_week) %>%
    summarize(total_activity = sum(counts)) %>%
    ggplot(aes(x = minute_in_day, y = total_activity, color = day_in_week)) +
      geom_point(size = 0.2) +
      geom_smooth() +
      facet_grid(. ~ day_in_week) 
```

    ## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'

<img src="p8105_mtp_zf2213_files/figure-gfm/unnamed-chunk-3-2.png" width="100%" />

### Supplementary material

``` r
# some feature days
activity %>% 
  filter(day %in% c(0, 49, 55, 92, 107:108, 185, 243, 244, 300)) %>%
    ggplot(aes(y = log10(counts), x = minute_in_day, color = as.factor(day))) +
      geom_point(size = 0.5) +
      facet_grid(day ~ .)
```

<img src="p8105_mtp_zf2213_files/figure-gfm/unnamed-chunk-4-1.png" width="100%" />
