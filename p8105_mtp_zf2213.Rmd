---
title: "p8105 midterm project"
author: 'Zanis Fang, UID: ZF2213'
date: "10/16/2018"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
```

**three or four figures would be enough**

### loading data

Columns are values rather than variables, load data and gather the columns

```{r loading_data}
# loading data and make to tall table
acc <- read_csv("./data/p8105_mtp_data.csv") %>% 
	# gather into long table
	gather(key = "time_activity", value = "accel", activity.1:activity.1440)
```

The dataset records every minute in a day. There are in total 329 days.

### Data tidying

1. Get the nth minute of a day

```{r}
# do some tidy
acc <- acc %>% 
	# get the "minute" of a day, 
	mutate(time_activity = str_replace(time_activity, "activity.", "")) %>% 
	# change to integer
	mutate(time_activity = as.integer(time_activity)) %>% 
	# floor division get hour:minute of each day
	mutate(hour = time_activity %/% 60, minute = time_activity %% 60) %>% 
	# make day variable factor and relevel the day variable
	mutate(day = forcats::fct_relevel(day, c("Sunday", "Monday", "Tuesday",
																					 "Wednesday", "Thursday",
																					 "Friday", "Saturday"))) %>% 
	# assuming the start of the first week is Sunday
	mutate(day_of_period = (week - 1) * 7 + as.integer(day))
	
```

### Get distribution of the data


```{r sub_group}
# take a look at activity distribution
acc %>% ggplot(aes(x = accel)) +
	geom_density() +
	scale_x_log10(breaks = 2^c(1:12)) +
	theme(axis.text.x = element_text(angle = 90))


```

It would be unreasonable to take the average of signals across time.

It seems there are two "types" of activity, low intensity activity, such as sleep, sit, etc, and high intensity activity, such as walk, run, climb stairs, etc. And there is a middle type activity. The following analysis are based on these three types of activities.

### Activities over a day


```{r cutoff}

# subgroup range of activity 
acc <- acc %>% mutate(range_accel = cut(accel, c(0, 8, 32, Inf), labels = c(1:3))) 
acc %>% count(range_accel)
```

```{r}
# across a day
acc %>%
	group_by(time_activity, range_accel) %>%
	# sum of activities may be more meaningful
	summarize(sum_activity = sum(accel)) %>%
	group_by(range_accel) %>% 
	mutate(group_mean = mean(sum_activity)) %>%
	# normalize against the average of each type of activities
	ggplot(aes(x = time_activity, y = sum_activity / group_mean, color = range_accel)) +
	  geom_line() +
	  facet_grid(range_accel ~ .)

# display activities each day using 2d density plot
acc %>%
	mutate(range_accel = cut(accel, c(0, 8, 32, 64, 128, 256, Inf), labels = c(1:6))) %>% 
	ggplot(aes(x = time_activity, y = day_of_period, color = as.numeric(range_accel))) +
	  geom_point()

# across day of the period
acc %>%
	group_by(day_of_period, day, range_accel) %>% 
	summarize(sum_activity = sum(accel)) %>% 
	group_by(range_accel) %>% 
	# mean of sum of group
	mutate(group_mean = mean(sum_activity)) %>%
	ggplot(aes(x = day_of_period, y = sum_activity / group_mean, color = range_accel)) +
	  geom_line() +
	  geom_smooth() +
	  facet_grid(range_accel ~ .)

# across week
acc %>%
	group_by(day, range_accel) %>%
	summarize(sum_activity = sum(accel)) %>%
	group_by(range_accel) %>% 
	mutate(group_mean = mean(sum_activity)) %>% 
	ggplot(aes(x = day, y = sum_activity / group_mean, group = range_accel, color = range_accel)) +
	  geom_line()


# across day of the period + week, mean
acc %>%
	group_by(day_of_period, day, range_accel) %>% 
	summarize(sum_activity = sum(accel)) %>%
	group_by(range_accel) %>% 
	# get mean of sum_activity for each group for normalization
	mutate(group_mean = mean(sum_activity)) %>% 
	ggplot(aes(x = day_of_period, y = sum_activity / group_mean, color = range_accel)) +
	  geom_line() +
	  geom_smooth() +
	  facet_grid(range_accel ~ day)

```

